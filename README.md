# Digia UI SDK

[![Flutter](https://img.shields.io/badge/Flutter-3.0+-blue.svg)](https://flutter.dev)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Documentation](https://img.shields.io/badge/docs-digia.tech-blue.svg)](https://docs.digia.tech)

<div align="center">
  <h1>
    <span style="background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent;">
      DigiaUI SDK
    </span>
  </h1>
</div>

**Digia UI SDK** is the Flutter-based rendering engine for [Digia Studio](https://digia.studio), a low-code mobile application platform. Built on the Server-Driven UI (SDUI) architecture, this SDK dynamically renders native Flutter widgets based on configurations received from the server, enabling real-time UI updates without requiring app releases or store approvals.

## üöÄ Overview

### What is Server-Driven UI?

Server-Driven UI (SDUI) is an architectural pattern where the server controls the presentation layer of your application by sending UI configurations that the client interprets and renders. This approach offers several key advantages:

- **üöÄ Instant Updates** - Deploy UI changes immediately without app store review cycles
- **üß™ A/B Testing** - Run experiments and personalize experiences without client-side release cycles
- **üîß Bug Fixes** - Fix UI issues in production without releasing a new app version
- **üì± Cross-Platform Consistency** - Ensure uniform experiences across Android, iOS, and Mobile Web from a single configuration

### The Digia Ecosystem

Digia UI SDK is part of the Digia Studio ecosystem, where:

1. **Digia Studio** - A visual low-code tool where users drag and drop widgets to create mobile applications
2. **Server Configurations** - The studio generates structured configurations describing UI layout, data bindings, and business logic
3. **Digia UI SDK** - This Flutter SDK interprets the server configurations to render fully functional native mobile apps across Android, iOS, and Mobile Web platforms

### Key Features

- üé® **Server-Driven UI** - Render Flutter widgets from server-side configurations
- üîÑ **Instant Updates** - Push UI and logic changes instantly without app store approvals
- üîó **Expression Binding** - Powerful data binding system for dynamic content
- üéØ **Pre-built Actions** - Navigation, state management, API calls, and more
- üì± **Native Performance** - Direct compilation to native code with Flutter's performance
- üß© **Custom Widgets** - Register your own widgets to extend functionality
- üåê **Multi-Platform** - Single codebase for Android, iOS, and Mobile Web

## üì¶ Installation

Add Digia UI SDK to your `pubspec.yaml`:

```yaml
dependencies:
  digia_ui: ^latest_version
```

Run:

```bash
flutter pub get
```

## üèÅ Getting Started

> **Note**: Digia UI SDK requires configurations generated by [Digia Studio](https://digia.studio). Please refer to the [Digia Studio documentation](https://docs.digia.tech) to create your first project.

### Initialization of DigiaUI SDK

DigiaUI SDK offers two initialization strategies to suit different application needs:

#### NetworkFirst Strategy

- **Prioritizes fresh content** - Always fetches the latest DSL configuration from the network first
- **Fast performance** - DSL is hosted on CDN with average load times under 30ms for large projects
- **Recommended for production** - Ensures users always see the most up-to-date UI
- **Best for** - Apps where having the latest content is critical

#### CacheFirst Strategy

- **Instant startup** - Uses cached DSL configuration for immediate rendering
- **Fallback to network** - Fetches updates in the background for next session
- **Offline capable** - Works even without network connectivity
- **Best for** - Apps prioritizing fast startup times or offline functionality

### Implementation Options

#### Option 1: Using DigiaUIApp (NetworkFirst - Recommended)

Use this approach when you want to ensure users always see the latest UI configuration and can wait for the network request to complete:

```dart
void main() async {
    WidgetsFlutterBinding.ensureInitialized();

    final digiaUI = await DigiaUI.createWith(
        InitConfig(
            accessKey: 'YOUR_PROJECT_ACCESS_KEY',
            flavor: Flavor.release(),
            strategy: InitStrategy.networkFirst(), // Fetches latest DSL from CDN
        ),
    );

    runApp(
        DigiaUIApp(
            digiaUI: digiaUI,
            builder: (context) => MaterialApp(
                home: DUIFactory().createInitialPage(),
            ),
        ),
    );
}
```

#### Option 2: Using DigiaUIAppBuilder (CacheFirst)

Use this approach when you want instant app startup and can accept showing cached content initially:

```dart
import 'package:digia_ui/digia_ui.dart';

void main() {
    runApp(
        DigiaUIAppBuilder(
            options: InitConfig(
                accessKey: 'YOUR_PROJECT_ACCESS_KEY',
                flavor: Flavor.release(),
                strategy: InitStrategy.cacheFirst(), // Uses cached DSL, updates in background
            ),
            builder: (context, status) {
                if (status.isLoading) {
                    return const MaterialApp(
                        home: Scaffold(
                            body: Center(child: CircularProgressIndicator()),
                        ),
                    );
                }

                if (status.isError) {
                    return MaterialApp(
                        home: Scaffold(
                            body: Center(
                                child: Text('Error: ${status.error}'),
                            ),
                        ),
                    );
                }

                // SDK is ready with cached or fresh DSL
                return MaterialApp(
                    home: DUIFactory().createInitialPage(),
                );
            },
        ),
    );
}
```

#### Option 3: Hybrid Initialization with Custom Loading

For advanced use cases where you need fine-grained control over the initialization process:

```dart
void main() {
    runApp(
        DigiaUIAppBuilder(
            options: InitConfig(
                accessKey: 'YOUR_PROJECT_ACCESS_KEY',
                flavor: Flavor.release(),
                strategy: InitStrategy.networkFirst(
                    timeout: Duration(seconds: 5), // Custom timeout
                    fallbackToCache: true, // Use cache if network fails
                ),
            ),
            builder: (context, status) {
                if (status.isLoading) {
                    return MaterialApp(
                        home: Scaffold(
                            body: Column(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                    CircularProgressIndicator(),
                                    SizedBox(height: 16),
                                    Text('Loading latest content...'),
                                    if (status.hasCache)
                                        TextButton(
                                            onPressed: () => status.useCachedVersion(),
                                            child: Text('Use Offline Version'),
                                        ),
                                ],
                            ),
                        ),
                    );
                }

                if (status.isError) {
                    return MaterialApp(
                        home: Scaffold(
                            body: Center(
                                child: Column(
                                    mainAxisAlignment: MainAxisAlignment.center,
                                    children: [
                                        Icon(Icons.error_outline, size: 48),
                                        SizedBox(height: 16),
                                        Text('Failed to load content'),
                                        Text('Error: ${status.error}'),
                                        if (status.hasCache)
                                            ElevatedButton(
                                                onPressed: () => status.useCachedVersion(),
                                                child: Text('Use Cached Version'),
                                            ),
                                    ],
                                ),
                            ),
                        ),
                    );
                }

                // SDK is ready
                return MaterialApp(
                    home: DUIFactory().createInitialPage(),
                );
            },
        ),
    );
}
```

## üõ†Ô∏è Usage Patterns

Digia UI SDK supports two integration patterns:

### 1. Full App Mode

Build your entire app using Digia Studio and render it with the SDK:

```dart
MaterialApp(
    home: DUIFactory().createInitialPage(),
    onGenerateRoute: (settings) {
        // Let Digia UI handle all routing
        return DUIFactory().createPageRoute(
            settings.name!,
            settings.arguments as Map<String, dynamic>?,
        );
    },
)
```

### 2. Hybrid Mode

Migrate pages incrementally by mixing native Flutter screens with Digia UI pages:

```dart
// Navigate to a Digia UI page from native Flutter
Navigator.push(
    context,
    MaterialPageRoute(
        builder: (_) => DUIFactory().createPage('checkout_page', {
            'cartId': cartId,
            'userId': userId,
        }),
    ),
);
```

## üìÑ Creating Pages

Pages are full-screen UI definitions with lifecycle hooks and state management:

```dart
// Create a page with arguments
Widget checkoutPage = DUIFactory().createPage(
    'checkout_page',
    {
        'cartId': '12345',
        'totalAmount': 99.99,
    },
);

// Navigate to a page
Navigator.push(
    context,
    DUIFactory().createPageRoute('product_details', {
        'productId': product.id,
    }),
);
```

## üß© Creating Components

Components are reusable UI blocks that can be embedded anywhere:

```dart
// Create a reusable product card component
Widget productCard = DUIFactory().createComponent(
    'product_card',
    {
        'title': 'iPhone 15 Pro',
        'price': 999.99,
        'imageUrl': 'https://...',
        'onTap': () => print('Product tapped'),
    },
);

// Use in a ListView
ListView.builder(
    itemCount: products.length,
    itemBuilder: (context, index) {
        return DUIFactory().createComponent(
            'product_card',
            products[index].toJson(),
        );
    },
);
```

## üóÇÔ∏è State Management

Digia UI provides a comprehensive state management system with four levels:

### 1. Global State (App State)

Shared across the entire app and can persist between sessions:

```dart
// Set global state
DUIAppState().setValue('user', {
    'id': '123',
    'name': 'John Doe',
    'email': 'john@example.com',
});

// Get global state
final user = DUIAppState().value['user'];

// Listen to state changes
DUIAppState().addListener(() {
    print('Global state changed');
});
```

### 2. Page State

Scoped to individual pages and cleared when page is disposed:

```json
{
  "initStateDefs": {
    "cartItems": {
      "type": "list",
      "defaultValue": []
    },
    "isLoading": {
      "type": "boolean",
      "defaultValue": false
    }
  }
}
```

### 3. Component State

Local state for reusable components:

```json
{
  "initStateDefs": {
    "isExpanded": {
      "type": "boolean",
      "defaultValue": false
    }
  }
}
```

### 4. Local State

Widget-level state for UI interactions (managed internally by the SDK).

## üîÑ Native Code Integration

Share state between your native Flutter code and Digia UI pages:

```dart
// In your native Flutter code
class CartManager {
    void addToCart(Product product) {
        // Update your business logic
        cart.add(product);

        // Sync with Digia UI
        DUIAppState().setValue('cartCount', cart.length);
        DUIAppState().setValue('cartTotal', cart.totalAmount);
    }
}

// Access in Digia Studio expressions
// ${appState.cartCount}
// ${appState.cartTotal}
```

## üé® Custom Widget Registration

Extend Digia UI with your own custom widgets:

```dart
// Define your custom widget
class CustomMapWidget extends VirtualWidget<MapProps> {
    final MapProps props;

    @override
    Widget render(RenderPayload payload) {
        return GoogleMap(
            initialCameraPosition: CameraPosition(
                target: LatLng(props.latitude, props.longitude),
                zoom: props.zoom,
            ),
        );
    }
}

// Register during initialization
DUIFactory().registerWidget(
    'custom/map',
    MapProps.fromJson,
    (props, childGroups) => CustomMapWidget(props),
);
```

For detailed custom widget documentation, visit [docs.digia.tech](https://docs.digia.tech/custom-widgets).

## üìö Documentation

- **[Digia Studio Documentation](https://docs.digia.tech)** - Learn how to create projects and design UIs
- **[Custom Widgets Guide](https://docs.digia.tech/custom-widgets)** - Build and register custom widgets
- **[Expression Reference](https://docs.digia.tech/expressions)** - Data binding and expressions
- **[Actions Reference](https://docs.digia.tech/actions)** - Available actions and their parameters

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üÜò Support

- üìö [Documentation](https://docs.digia.tech)
- üí¨ [Community Forum](https://community.digia.tech)
- üêõ [Issue Tracker](https://github.com/digia/digia-ui/issues)
- üìß [Contact Support](mailto:support@digia.tech)

---

Built with ‚ù§Ô∏è by the Digia team
