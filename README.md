# Digia UI SDK

[![Flutter](https://img.shields.io/badge/Flutter-3.0+-blue.svg)](https://flutter.dev)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Documentation](https://img.shields.io/badge/docs-digia.tech-blue.svg)](https://docs.digia.tech)

**Digia UI SDK** is the Flutter-based rendering engine for [Digia Studio](https://digia.studio), a low-code mobile application platform. This SDK interprets JSON configurations generated by Digia Studio to render native Flutter widgets, handle data bindings through expressions, and execute pre-built actions - all without requiring app rebuilds or store approvals.

## 🚀 Overview

Digia UI SDK is part of the Digia Studio ecosystem, where:

1. **Digia Studio** - A visual low-code tool where users drag and drop widgets to create mobile applications
2. **JSON Output** - The studio generates JSON describing UI structure, data bindings (expressions), and actions
3. **Digia UI SDK** - This Flutter SDK interprets the JSON to render fully functional native mobile apps

### Key Features

- 🎨 **Server-Driven UI** - Render Flutter widgets from server-side JSON configurations
- 🔄 **Hot Updates** - Push UI and logic changes instantly without app store approvals
- 🔗 **Expression Binding** - Powerful data binding system for dynamic content
- 🎯 **Pre-built Actions** - Navigation, state management, API calls, and more
- 📱 **Native Performance** - Direct compilation to native code with Flutter's performance
- 🧩 **Custom Widgets** - Register your own widgets to extend functionality

## 📦 Installation

Add Digia UI SDK to your `pubspec.yaml`:

```yaml
dependencies:
  digia_ui: ^latest_version
```

Run:

```bash
flutter pub get
```

## 🏁 Getting Started

> **Note**: Digia UI SDK requires JSON configurations generated by [Digia Studio](https://digia.studio). Please refer to the [Digia Studio documentation](https://docs.digia.tech) to create your first project.

### Initialization

There are two ways to initialize Digia UI in your Flutter app:

#### Option 1: Using DigiaUIAppBuilder (Recommended)

```dart
import 'package:digia_ui/digia_ui.dart';

void main() {
    runApp(
        DigiaUIAppBuilder(
            options: InitConfig(
                accessKey: 'YOUR_PROJECT_ACCESS_KEY',
                flavor: Flavor.production(),
                developerConfig: DeveloperConfig(
                    baseUrl: 'https://api.digia.tech', // Optional: Override default
                ),
            ),
            builder: (context, status) {
                if (status.isLoading) {
                    return const MaterialApp(
                        home: Scaffold(
                            body: Center(child: CircularProgressIndicator()),
                        ),
                    );
                }

                if (status.isError) {
                    return MaterialApp(
                        home: Scaffold(
                            body: Center(
                                child: Text('Error: ${status.error}'),
                            ),
                        ),
                    );
                }

                // SDK is ready
                return MaterialApp(
                    home: DUIFactory().createInitialPage(),
                );
            },
        ),
    );
}
```

#### Option 2: Using DigiaUIApp

```dart
void main() async {
    WidgetsFlutterBinding.ensureInitialized();

    final digiaUI = await DigiaUI.createWith(
        InitConfig(
            accessKey: 'YOUR_PROJECT_ACCESS_KEY',
            flavor: Flavor.production(),
        ),
    );

    runApp(
        DigiaUIApp(
            digiaUI: digiaUI,
            builder: (context) => MaterialApp(
                home: DUIFactory().createInitialPage(),
            ),
        ),
    );
}
```

## 🛠️ Usage Patterns

Digia UI SDK supports two integration patterns:

### 1. Full App Mode

Build your entire app using Digia Studio and render it with the SDK:

```dart
MaterialApp(
    home: DUIFactory().createInitialPage(),
    onGenerateRoute: (settings) {
        // Let Digia UI handle all routing
        return DUIFactory().createPageRoute(
            settings.name!,
            settings.arguments as Map<String, dynamic>?,
        );
    },
)
```

### 2. Hybrid Mode

Migrate pages incrementally by mixing native Flutter screens with Digia UI pages:

```dart
// Navigate to a Digia UI page from native Flutter
Navigator.push(
    context,
    MaterialPageRoute(
        builder: (_) => DUIFactory().createPage('checkout_page', {
            'cartId': cartId,
            'userId': userId,
        }),
    ),
);
```

## 📄 Creating Pages

Pages are full-screen UI definitions with lifecycle hooks and state management:

```dart
// Create a page with arguments
Widget checkoutPage = DUIFactory().createPage(
    'checkout_page',
    {
        'cartId': '12345',
        'totalAmount': 99.99,
    },
);

// Navigate to a page
Navigator.push(
    context,
    DUIFactory().createPageRoute('product_details', {
        'productId': product.id,
    }),
);
```

## 🧩 Creating Components

Components are reusable UI blocks that can be embedded anywhere:

```dart
// Create a reusable product card component
Widget productCard = DUIFactory().createComponent(
    'product_card',
    {
        'title': 'iPhone 15 Pro',
        'price': 999.99,
        'imageUrl': 'https://...',
        'onTap': () => print('Product tapped'),
    },
);

// Use in a ListView
ListView.builder(
    itemCount: products.length,
    itemBuilder: (context, index) {
        return DUIFactory().createComponent(
            'product_card',
            products[index].toJson(),
        );
    },
);
```

## 🗂️ State Management

Digia UI provides a comprehensive state management system with four levels:

### 1. Global State (App State)

Shared across the entire app and can persist between sessions:

```dart
// Set global state
DUIAppState().setValue('user', {
    'id': '123',
    'name': 'John Doe',
    'email': 'john@example.com',
});

// Get global state
final user = DUIAppState().value['user'];

// Listen to state changes
DUIAppState().addListener(() {
    print('Global state changed');
});
```

### 2. Page State

Scoped to individual pages and cleared when page is disposed:

```json
{
  "initStateDefs": {
    "cartItems": {
      "type": "list",
      "defaultValue": []
    },
    "isLoading": {
      "type": "boolean",
      "defaultValue": false
    }
  }
}
```

### 3. Component State

Local state for reusable components:

```json
{
  "initStateDefs": {
    "isExpanded": {
      "type": "boolean",
      "defaultValue": false
    }
  }
}
```

### 4. Local State

Widget-level state for UI interactions (managed internally by the SDK).

## 🔄 Native Code Integration

Share state between your native Flutter code and Digia UI pages:

```dart
// In your native Flutter code
class CartManager {
    void addToCart(Product product) {
        // Update your business logic
        cart.add(product);

        // Sync with Digia UI
        DUIAppState().setValue('cartCount', cart.length);
        DUIAppState().setValue('cartTotal', cart.totalAmount);
    }
}

// Access in Digia Studio expressions
// ${appState.cartCount}
// ${appState.cartTotal}
```

## 🎨 Custom Widget Registration

Extend Digia UI with your own custom widgets:

```dart
// Define your custom widget
class CustomMapWidget extends VirtualWidget<MapProps> {
    final MapProps props;

    @override
    Widget render(RenderPayload payload) {
        return GoogleMap(
            initialCameraPosition: CameraPosition(
                target: LatLng(props.latitude, props.longitude),
                zoom: props.zoom,
            ),
        );
    }
}

// Register during initialization
DUIFactory().registerWidget(
    'custom/map',
    MapProps.fromJson,
    (props, childGroups) => CustomMapWidget(props),
);
```

For detailed custom widget documentation, visit [docs.digia.tech](https://docs.digia.tech/custom-widgets).

## 📚 Documentation

- **[Digia Studio Documentation](https://docs.digia.tech)** - Learn how to create projects and design UIs
- **[Custom Widgets Guide](https://docs.digia.tech/custom-widgets)** - Build and register custom widgets
- **[Expression Reference](https://docs.digia.tech/expressions)** - Data binding and expressions
- **[Actions Reference](https://docs.digia.tech/actions)** - Available actions and their parameters

## 🤝 Contributing

We welcome contributions! Please see our [Contributing Guide](CONTRIBUTING.md) for details.

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🆘 Support

- 📚 [Documentation](https://docs.digia.tech)
- 💬 [Community Forum](https://community.digia.tech)
- 🐛 [Issue Tracker](https://github.com/digia/digia-ui/issues)
- 📧 [Contact Support](mailto:support@digia.tech)

---

Built with ❤️ by the Digia team
